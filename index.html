<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>言えるかな？ゲーム</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;700&display=swap" rel="stylesheet">
</head>

<body>
    <header class="game-header">
        <img src="assets/premium_header.png" alt="Premium Header Illustration" class="header-image">
        <h1>言えるかな？ゲーム</h1>
        <p class="subtitle" id="topic-title">お題を選んでね！</p>
    </header>

    <!-- Portal Display -->
    <main id="portal-view" class="portal-container">
        <div class="portal-header" style="display:flex; justify-content:space-between; align-items:flex-end;">
            <h2>お題一覧（ポータル）</h2>
            <button id="auth-btn" class="btn btn-secondary btn-small"
                style="font-size: 0.9rem; padding: 0.5rem 1rem;">🔑 ログイン</button>
        </div>
        <p>遊びたいお題をクリックしてスタート！</p>
        <div id="topic-list" class="topic-grid">
            <!-- Topic Cards injected here -->
        </div>
        <div class="portal-actions">
            <button id="open-create-modal-btn" class="btn btn-secondary btn-full">＋ 新しいお題を作る</button>
        </div>
    </main>

    <!-- Main Game Display -->
    <main id="game-view" class="game-container" style="display: none;">
        <div class="status-bar">
            <div class="time-box">
                <span class="label">タイム</span>
                <span class="value" id="time-display">00:00.00</span>
            </div>
            <div class="score-box">
                <span class="label">正解数</span>
                <span class="value" id="score-display">0 / 0</span>
            </div>
        </div>

        <div class="input-section">
            <input type="text" id="answer-input" placeholder="ここに入力してね！" autocomplete="off" disabled>
        </div>

        <div class="actions">
            <button id="giveup-btn" class="btn btn-secondary" disabled>ギブアップ</button>
            <button class="btn btn-text back-to-portal-btn">← 一覧に戻る</button>
        </div>

        <div class="answers-container">
            <div id="answers-grid" class="answers-grid">
                <!-- Answer items will be injected here -->
            </div>
        </div>
    </main>

    <!-- Start Modal -->
    <div id="start-modal" class="modal">
        <div class="modal-content">
            <h2>準備はいい？</h2>
            <p id="start-topic-desc">お題：都道府県 (47個)</p>
            <p>※漢字、ひらがな、どちらでも正解になるよ！（※データ作成者によります）</p>
            <button id="start-btn" class="btn btn-primary btn-large">ゲームスタート！</button>
        </div>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal">
        <div class="modal-content">
            <h2 id="result-title">タイムアップ！</h2>
            <div class="result-score">
                <span class="result-number" id="result-score">0</span>
                <span class="result-total" id="result-total">/ 0</span>
            </div>
            <p id="result-message">がんばったね！</p>
            <div class="result-actions">
                <button id="retry-btn" class="btn btn-primary btn-full">もう一度プレイ</button>
                <button class="btn btn-secondary btn-full back-to-portal-btn">一覧に戻る</button>
                <button id="close-result-btn" class="btn btn-text">閉じる</button>
            </div>
        </div>
    </div>

    <!-- Create Topic Modal -->
    <div id="create-topic-modal" class="modal">
        <div class="modal-content">
            <h2>新しいお題を作る</h2>
            <p>タイトルと答えを入力しよう！エンターキーでどんどん答えを追加できるよ。</p>

            <div class="create-topic-form">
                <div class="ai-generate-group item-input-group"
                    style="border-color: rgba(255, 42, 133, 0.4); background: rgba(255, 42, 133, 0.05); box-shadow: inset 0 0 15px rgba(255,42,133,0.1);">
                    <p class="items-label"
                        style="display: flex; justify-content: space-between; align-items: center; color: #FF2A85;">
                        <span style="font-weight:bold; letter-spacing:1px;">✨ AIにおまかせ生成</span>
                        <span class="beta-badge">Pro機能</span>
                    </p>
                    <div class="input-with-button">
                        <input type="text" id="ai-prompt-input" class="create-input"
                            style="border-color: rgba(255,42,133,0.3);" placeholder="例: 歴代の総理大臣、ジブリ映画...">
                        <button id="ai-generate-btn" class="btn btn-ai btn-sm">生成</button>
                    </div>
                </div>

                <hr class="form-divider">

                <input type="text" id="new-topic-title" class="create-input" placeholder="お題のタイトル (例: 好きな果物)">

                <div class="item-input-group">
                    <p class="items-label">答えを追加</p>
                    <input type="text" id="new-topic-item-display" class="create-input" placeholder="表示名 (漢字など 例: 林檎)">
                    <input type="text" id="new-topic-item-hiragana" class="create-input"
                        placeholder="入力する言葉 (ひらがな 例: りんご)">
                    <div class="input-with-button">
                        <input type="text" id="new-topic-item-alt" class="create-input"
                            placeholder="別解 (カンマ区切り、任意 例: リンゴ, アップル)">
                        <button id="add-topic-item-btn" class="btn btn-secondary btn-sm">追加</button>
                    </div>
                </div>

                <div class="added-items-container">
                    <p class="items-label">追加された答え (<span id="new-topic-count">0</span>個):</p>
                    <ul id="new-topic-item-list" class="item-tags">
                        <!-- Items injected here -->
                    </ul>
                </div>
            </div>

            <p id="create-topic-error" class="error-text"></p>

            <div class="result-actions" style="margin-top: 1.5rem;">
                <button id="save-topic-btn" class="btn btn-primary btn-full">保存してポータルに追加</button>
                <button id="cancel-topic-btn" class="btn btn-text">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h2 id="auth-title">ログイン</h2>
            <p id="auth-desc" style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-bottom: 1rem;">
                アカウントを作成して自分の記録を残そう！</p>
            <div class="create-topic-form">
                <input type="text" id="auth-username" class="create-input" placeholder="ユーザーネーム (例: tanaka123)">
                <input type="password" id="auth-password" class="create-input" placeholder="パスワード"
                    style="margin-top: 0.5rem;">
                <p id="auth-error" class="error-text"></p>
                <div class="result-actions" style="margin-top: 1.5rem;">
                    <button id="auth-action-btn" class="btn btn-primary btn-full">ログインする</button>
                    <button id="auth-toggle-btn" class="btn btn-text">新規登録はこちら</button>
                    <button id="auth-cancel-btn" class="btn btn-text">キャンセル</button>
                </div>
            </div>
        </div>
    </div>

    <!-- My Page Modal -->
    <div id="mypage-modal" class="modal">
        <div class="modal-content">
            <h2>マイページ</h2>
            <p>ようこそ、<span id="mypage-username-display" style="font-weight:bold; color:#FF2A85;"></span> さん！</p>

            <div class="added-items-container" style="margin-top: 1.5rem; max-height: 40vh; overflow-y: auto;">
                <p class="items-label">作成したお題一覧:</p>
                <div id="mypage-topic-list" class="topic-grid"
                    style="grid-template-columns: 1fr; gap: 0.5rem; display: flex; flex-direction: column;">
                    <!-- User's topics injected here -->
                </div>
            </div>

            <div class="result-actions" style="margin-top: 1.5rem;">
                <button id="logout-btn" class="btn btn-secondary btn-full">ログアウト</button>
                <button id="mypage-close-btn" class="btn btn-text">閉じる</button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2 id="leaderboard-title">ランキング</h2>

            <div class="added-items-container" style="margin-top: 1.5rem; max-height: 40vh; overflow-y: auto;">
                <ul id="leaderboard-list"
                    style="list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 0.5rem;">
                    <!-- Rankings injected here -->
                </ul>
            </div>

            <div class="result-actions" style="margin-top: 1.5rem;">
                <button id="leaderboard-close-btn" class="btn btn-secondary btn-full">閉じる</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="script.js"></script>
</body>

</html>